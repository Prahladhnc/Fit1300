{% extends "base.html" %}
{% block content %}

<div class="text-center mb-4">
    <div class="stats-title-box d-inline-block">
        <h2 class="text-primary mb-0">Club Statistics</h2>
    </div>
</div>

<!-- ========================= -->
<!-- Existing Stats Summary -->
<!-- ========================= -->

<div class="row justify-content-center">
    {% for s in stats %}
    <div class="col-md-5 col-lg-4 mb-4">
        <div class="card shadow-sm border-0" style="background: rgba(255,255,255,0.35); backdrop-filter: blur(6px);">
            <div class="card-body text-center">
                <h4 class="card-title text-uppercase fw-bold">{{ s.sport }}</h4>
                <p class="card-text mb-1">üèÉ Unique Athletes: <strong>{{ s.unique_athletes }}</strong></p>
                <p class="card-text mb-1">üìä Total Activities: <strong>{{ s.total_activities }}</strong></p>
                <p class="card-text mb-1">üìè Total Distance: <strong>{{ "%.2f"|format(s.total_distance) }} km</strong></p>
                <p class="card-text">‚è±Ô∏è Total Time: <strong>{{ s.total_time }}</strong></p>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<hr class="my-5">

<!-- ========================= -->
<!-- Charts Section -->
<!-- ========================= -->

<div class="row justify-content-center">

    <!-- Member Count Chart -->
    <div class="col-md-6 mb-4">
        <div class="card shadow-sm border-0" style="background: rgba(255,255,255,0.35); backdrop-filter: blur(6px);">
            <div class="card-body">
                <h5 class="text-center text-primary fw-bold">Members Count Over Time</h5>
                <div style="height: 300px;">
                    <canvas id="memberChart" style="background:white; border-radius:12px;"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Cycling Chart -->
    <div class="col-md-6 mb-4">
        <div class="card shadow-sm border-0" style="background: rgba(255,255,255,0.35); backdrop-filter: blur(6px);">
            <div class="card-body">
                <h5 class="text-center text-warning fw-bold">Cycling Distance Over Time</h5>
                <div style="height: 300px;">
                    <canvas id="cycleChart" style="background:white; border-radius:12px;"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Running Chart -->
    <div class="col-md-6 mb-4">
        <div class="card shadow-sm border-0" style="background: rgba(255,255,255,0.35); backdrop-filter: blur(6px);">
            <div class="card-body">
                <h5 class="text-center text-danger fw-bold">Running Distance Over Time</h5>
                <div style="height: 300px;">
                    <canvas id="runChart" style="background:white; border-radius:12px;"></canvas>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- ========================= -->
<!-- Chart.js Script -->
<!-- ========================= -->

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    const dates = {{ dates|tojson }};
    const members = {{ members|tojson }};
    const cycle = {{ cycle|tojson }};
    const run = {{ run|tojson }};

    // Reusable chart generator
    function makeChart(ctx, label, data, color) {
        return new Chart(ctx, {
            type: 'line',
            data: {
                labels: dates,
                datasets: [{
                    label: label,
                    data: data,
                    borderColor: color,
                    backgroundColor: color,
                    borderWidth: 2,
                    tension: 0.35,
                    pointRadius: 3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        ticks: { color: 'black' },
                        grid: { color: 'rgba(0,0,0,0.1)' }
                    },
                    y: {
                        ticks: { color: 'black' },
                        grid: { color: 'rgba(0,0,0,0.1)' }
                    }
                },
                plugins: {
                    legend: { labels: { color: 'black' } }
                }
            }
        });
    }

    // Create 3 charts
    makeChart(document.getElementById('memberChart'), "Members", members, "blue");
    makeChart(document.getElementById('cycleChart'), "Cycle KM", cycle, "yellow");
    makeChart(document.getElementById('runChart'), "Run KM", run, "red");
</script>

{% endblock %}
